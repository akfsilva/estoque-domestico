<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estoque Dom√©stico</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.png">

<style>
body {
  background:#0f1f0f;
  color:#7CFF7C;
  font-family: monospace;
  margin:0;
  padding:10px;
}

h1 {
  display:flex;
  align-items:center;
  gap:10px;
}

h2 {
  cursor:pointer;
  margin-top:20px;
}

.category {
  border:1px solid #3aff3a;
  padding:10px;
  margin-bottom:10px;
}

.item {
  display:flex;
  gap:5px;
  margin:5px 0;
}

input, button {
  background:#000;
  color:#7CFF7C;
  border:1px solid #3aff3a;
  padding:5px;
}

button {
  cursor:pointer;
}

.progress {
  height:6px;
  background:#1f3f1f;
  margin-top:4px;
}

.progress-bar {
  height:6px;
  background:#7CFF7C;
  width:0%;
}
</style>
</head>

<body>

<h1>
  <img src="icon-192.png" width="32">
  Estoque Dom√©stico
</h1>

<h3>Adicionar item</h3>
<input id="itemName" placeholder="Item">
<input id="itemCategory" placeholder="Categoria">
<input id="itemHave" type="number" placeholder="Qtd atual">
<input id="itemGoal" type="number" placeholder="Meta anual">
<button onclick="addItem()">Adicionar</button>

<div id="categories"></div>

<script>
let data = JSON.parse(localStorage.getItem("estoque")) || {};

function normalizeCategory(name) {
  return name.trim().toLowerCase();
}

function addItem() {
  const name = itemName.value.trim();
  const categoryRaw = itemCategory.value.trim();
  const have = Number(itemHave.value);
  const goal = Number(itemGoal.value);

  if (!name || !categoryRaw) return;

  const normalized = normalizeCategory(categoryRaw);

  // üîπ procura categoria existente
  let categoryKey = Object.keys(data).find(
    c => normalizeCategory(c) === normalized
  );

  if (!categoryKey) {
    categoryKey = categoryRaw;
    data[categoryKey] = [];
  }

  data[categoryKey].push({
    name,
    have,
    goal
  });

  save();
  render();
}

function removeItem(category, index) {
  data[category].splice(index,1);
  if (data[category].length === 0) delete data[category];
  save();
  render();
}

function render() {
  const container = document.getElementById("categories");
  container.innerHTML = "";

  for (const category in data) {
    const catDiv = document.createElement("div");
    catDiv.className = "category";

    const title = document.createElement("h2");
    title.textContent = category;
    title.onclick = () => {
      list.style.display = list.style.display === "none" ? "block" : "none";
    };

    const list = document.createElement("div");

    data[category].forEach((item, i) => {
      const div = document.createElement("div");
      div.className = "item";

      const percent = item.goal ? Math.min(100, Math.round((item.have/item.goal)*100)) : 0;

      div.innerHTML = `
        ${item.name}
        <input type="number" value="${item.have}" onchange="data['${category}'][${i}].have=this.value;save();render()">
        / ${item.goal}
        <button onclick="removeItem('${category}',${i})">X</button>
        <div class="progress"><div class="progress-bar" style="width:${percent}%"></div></div>
      `;
      list.appendChild(div);
    });

    catDiv.appendChild(title);
    catDiv.appendChild(list);
    container.appendChild(catDiv);
  }
}

function save() {
  localStorage.setItem("estoque", JSON.stringify(data));
}

render();
</script>

</body>
</html>
